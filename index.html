<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>林宏軒 & 陳仲薇 家宴邀請</title>
  <style>
    /* 簡單樣式重現粉紅卡片設計 */
    :root {
      --pink-1: #ffd7e6;
      --pink-2: #f7c0d1;
      --accent: #e21f4d;
      --card-bg: #fff;
      --radius: 12px;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Helvetica Neue", Arial, "Microsoft JhengHei", sans-serif;
      background:
        linear-gradient(180deg, rgba(255, 215, 230, 0.85), rgba(255, 255, 255, 0.85) 40%),
        url('./lovepik.png') repeat fixed;
      background-size: 150px auto;
      padding: 24px;
      color: #333;
      min-height: 100vh;
      margin: 0;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
    }
    .card {
      background: var(--card-bg);
      border-radius: var(--radius);
      box-shadow: 0 6px 18px rgba(0,0,0,0.06);
      padding: 18px;
      margin-bottom: 18px;
    }
    h1.title {
      color: var(--accent);
      margin: 0 0 12px;
      font-size: 22px;
      text-align: center;
    }
    h2 {
      color: var(--accent);
      margin: 0 0 8px;
      font-size: 18px;
    }
    label { 
      display: block; 
      margin: 12px 0 6px; 
      font-weight: 600; 
      color: #8b2b48; 
    }
    input[type="text"], input[type="email"], input[type="number"], textarea, select {
      width: 100%;
      padding: 10px 12px;
      border: 1px solid #eee;
      border-radius: 8px;
      box-sizing: border-box;
      background: #fff;
      font-size: 14px;
    }
    input:focus, textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 2px rgba(226, 31, 77, 0.1);
    }
    .radio-group { 
      display: flex; 
      gap: 12px; 
      align-items: center; 
      margin-top: 6px; 
    }
    .radio-group label {
      display: flex;
      align-items: center;
      margin: 0;
      font-weight: normal;
      gap: 6px;
    }
    .btn {
      display: block;
      background: linear-gradient(180deg, var(--accent), #b10d36);
      color: white;
      border: none;
      width: 100%;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      margin-top: 14px;
      transition: transform 0.2s;
    }
    .btn:hover {
      transform: translateY(-1px);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .muted { 
      color: #888; 
      font-size: 13px; 
      margin-top: 8px;
    }
    .status {
      padding: 8px 12px;
      border-radius: 6px;
      margin-top: 8px;
      font-size: 14px;
    }
    .status.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    .status.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    .status.loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    /* Album card */
    .album-empty {
      border: 2px dashed #f2c9d8;
      padding: 30px;
      border-radius: 10px;
      text-align: center;
      color: #c66;
    }
    .pa-carousel-widget {
      border-radius: 8px;
      overflow: hidden;
    }
    /* 響應式設計 */
    @media (max-width: 480px) {
      body {
        padding: 12px;
      }
      .card {
        padding: 12px;
      }
      h1.title {
        font-size: 20px;
      }
    }
  </style>
  <!-- publicalbum 載入 -->
  <script src="https://cdn.jsdelivr.net/npm/publicalbum@latest/embed-ui.min.js" async></script>
</head>
<body>
  <div class="container">

    <h1 class="title">🎉 宏軒仲薇敬邀參加家宴</h1>

    <!-- 婚宴邀請資訊卡片 -->
    <div class="card" style="text-align: center; background: linear-gradient(135deg, var(--pink-1), #fff9fc);">
      <h2 style="color: var(--accent); margin-bottom: 16px;">💕 喜帖</h2>
      
      <div style="line-height: 1.8; color: #5d1a2e; font-size: 15px;">
        <p style="margin: 8px 0; font-weight: 600;">謹訂於民國114年11月29日</p>
        <p style="margin: 8px 0;">（星期六，農曆甲辰年十月廿九日）</p>
        <p style="margin: 8px 0; font-weight: 600; color: var(--accent);">舉行家宴</p>
        
        <div style="margin: 16px 0; padding: 12px; background: rgba(255, 255, 255, 0.7); border-radius: 8px;">
          <p style="margin: 4px 0;"><strong>新郎：</strong>林宏軒 先生</p>
          <p style="margin: 4px 0;"><strong>新娘：</strong>陳仲薇 小姐</p>
        </div>
        
        <div style="margin: 16px 0; text-align: left; background: rgba(255, 255, 255, 0.7); padding: 12px; border-radius: 8px;">
          <p style="margin: 4px 0;"><strong>🏢 宴客地點：</strong>驥園川菜餐廳</p>
          <p style="margin: 4px 0;"><strong>🕐 宴客時間：</strong>中午12時00分入席</p>
          <p style="margin: 4px 0;"><strong>📍 地址：</strong>106台北市大安區敦化南路1段324號</p>
          <p style="margin: 8px 0 4px;"><strong>🗺️ 餐廳位置：</strong></p>
          <a href="https://share.google/7VAaVfcyfAggRWBpj" target="_blank"
             style="color: var(--accent); text-decoration: none; font-weight: 600;
                    display: inline-block; padding: 6px 12px; background: rgba(226, 31, 77, 0.1);
                    border-radius: 6px; transition: background 0.2s;"
             onmouseover="this.style.background='rgba(226, 31, 77, 0.2)'"
             onmouseout="this.style.background='rgba(226, 31, 77, 0.1)'">
            🌐 Google 地圖位置
          </a>
        </div>
        
        <p style="margin: 16px 0 8px; font-weight: 600; color: var(--accent); font-size: 16px;">
          誠摯邀請闔府光臨
        </p>
        <p style="margin: 0; font-size: 13px; color: #888;">敬邀</p>
      </div>
    </div>

    <!-- 相片集卡片（使用 publicalbum 嵌入 Google Photos 分享相簿） -->
    <div class="card">
      <h2>📷 小小花絮</h2>
      
      <!-- publicalbum 嵌入語法 -->
      <div style="margin-top:12px;">
        <div class="pa-carousel-widget" style="width:100%; height:480px; display:block;"
             data-link="https://photos.app.goo.gl/MrS4JA9gjTjm1GdZ6"
             data-title="📸"
             data-description="共享相簿 · 點擊查看！">
          <object data="https://lh3.googleusercontent.com/pw/AP1GczPCx3Aef4tlt6doIKqPjTFgL02eNmzS8YyK9gwqzwTPkQC-xCec5dkGmnjNOJ4sCMSmMaR9zs3ulCrdT27s7DTrFdDFROGA2_AULxT20DznGCGMNRYw=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczNN08ulSwp0nniWIvgVBupota5KZY2xVf7eu8Ujtj5Pyn5759UMtYndbO_YHGzpzcwRk1DgCvTvxhxaDYefDjPaNMxZN8BaFXHJVLUa0qWLTQSsiOn0=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczPoarRfqi4BE1yBHzbR1yqIwleLxg9zQvpw9AUgGpIXWISrx1N6bmoWonKyKz61jqbsv-flDFu4j06BoKPwae7FgllS4NFx0K-R83EDsqno0wTGsz_p=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczNwuYAA8V1YCRW6K_IhNn8reutu1uRxksSJAh6LUra650D3ft0JXVP25Ep_xdhcfLCA2YP5-e-RureG5-tBGvVpYBW_lek8GjkRU8o49vZzxRiX7Zz5=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMSerFzBr82GcfU9jlDOM05bLesU8O6Tkww78XYFedC-aKkZd1HRqktykhUSo6pWEwnyzxCvvZBUO4YMVICmgkID4SzM-UuJ0KTHi2hNT1AwI7BeT7v=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczPPZkOLWQAgTfI7whgFk-gS3MuW3YYfdgL6-GMOS-YmycaGgS3kDLE8II9TDNB7MUUktYw7ytxLyDs5xDafyjAuJxywU-tjyO3aNTvOXEx7RdW4p1N8=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczN7UzwwsmHfxfOofyzfmSVb_91H6gjyEj_A_Iy8-9M2D7Eqz4Ouaqczv-BEqc9eHLvKd8sJocaxCDtugfGxmoOFbY2nFoPwgbz_QI1JKovWZwfa2MrR=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMoilzWhylQIwkGezZTb5Ad1qDBgzd0SsvQCoXD6iv6YHlLx4OpmjoYo140D05ZeJxDq2xDMLiBgEcYWIQdmmqxrrT7Qc1HgDVft76cHuOriyS2d5-g=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczOdY16WOFBoEV83ckQ6ypVxeAAir-ZoA7pNkLWc25YQV3lUJ-0kpmxRoChA-6hBa1DKlV_XYL7InbxRxcH9Rcytl5nwoNE_xtORZHptkE2G1vVd8rmk=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczN2r-TwTesv_hqfJTRh9VM49yMLziVzAXd6HX1o6XEk-ZOeEJpcZJaZLAlCuQB_s9q9nljbUnELJSo9X_OUtkPtQxG7qeG-EwL5DWEOYvFd--nH00JZ=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczO4DVUUM3scbAMomT5wMTTdr2azItYWg9036FbsER7TZNCU-o5hX4cr5LDAIf2-JLgK2De6svLbHpBYbgzrJIe6lI3z4Fwy-AKZ1Vjnpt5wNR1cmAhA=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMZEEsSZgLmmmSYkDFTGtJZ7fTDJfesTL2kjoZKGC61rpciUXE2iFZT9OSwU0kRGmdKA1z0yRRd4PLCp_wtBwmi7pTdm5f6rkOauHWaC3k5wK8ODPVu=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMZ_ONLZD_DmUbsHF0yQhhS-Q8q5dsWRA5v2lLr1JCLLGwcqieUDmNskc6o2761Oj0HIoZ-7RsG2m53a72s7HrkawVArt-v_QiKnIJ3qUExmHWE-MEx=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMQ9eCYAYee9U5jNwrvMNhjPC6OxyVTEtDZ_KGv94SZ7wSgF9xtclodGhOnracOFgQlmdWHErJH_6FSUU3lpYlpwtF7P_IHoHV4IBBfGihTZ6hOacyn=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczNLo1oW_s-sUxBcao33cX361Uy3tpNAg2JEb5xF7xyIUZE1qESph3SM0pwhL-g1UijupLLRzinCu2_Fwif7OMKidyjRxkLbhcGh6nwKovFWht3A10u6=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMGIxI2ABIajVjs-XQOYmfgl3YyS29E5YO1da6bXoAse7-F_kvTzKySAM7hCWQM_QWLYkiAit_U4ufyuWFl5uSQ0oPN1fJY7JAIaloRaQftGMyhccz5=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczPeakDtHrjRJDmB5BaNcORIZ9ClYQbPTg7Dq4DctuyMBsFIB2wFuNLEp8bcynQ2Tai7j-H8Pg6ZriDQ3JRQd433gxlz56zyxVozmEsW6GgEZQD0Woia=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczMXUVabb185AGIdYLQdh8UX--ajNwQ8x8ZA66L27grzaQSTB3QDH64w070Bpq3C9V1MHa1zQVc7dsdaR0qwFhPwWYkVAKA8Ez1UIxF_aiSyKU1EejTx=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczPB3Zo67PTl3ta3OKlzJ_4cy8qaDd1ul7pBy-V6h07LLsERMtIn93fYqbM3MM6MsbWtBnI7uN8p66yD0AlCabDIE2mw7F8DwfbMDKXJud93vh5U_t-F=w1920-h1080"></object>
          <object data="https://lh3.googleusercontent.com/pw/AP1GczNIGMej80GKCgfu9HqZARpggK1hyiInOEj4PKGijTqHTCUOH0sRkv0yjMRedHlIyvkHtcsPNOpyBjJ035QSrkxaomxQF5A5bNMZ6NAENU7eHXUKcw_w=w1920-h1080"></object>
        </div>
      </div>
    </div>

    <!-- RSVP 表單 -->
    <div class="card">
      <h2>📝 回覆 RSVP</h2>
      <p class="muted">請填寫以下資訊，讓我們知道您是否參加家宴</p>
      <form id="rsvpForm">
        <label>姓名 *</label>
        <input name="name" type="text" placeholder="請輸入您的姓名" required />

        <label>Email</label>
        <input name="email" type="email" placeholder="例如：name@example.com（用於再次編輯與通知）" />

        <label>是否參加 *</label>
        <div class="radio-group">
          <label><input type="radio" name="attend" value="yes" checked /> 是，我會參加</label>
          <label><input type="radio" name="attend" value="no" /> 不，我無法參加</label>
        </div>

        <label>出席人數 *</label>
        <input name="num_people" type="number" min="1" max="20" value="1" required />
        <p class="muted">包含您本人在內的總人數</p>

        <label>備註（選填）</label>
        <textarea name="note" rows="3" placeholder="例如：是否攜帶小朋友、飲食限制、交通安排等"></textarea>

        <button class="btn" type="submit" id="submitBtn">送出回覆</button>
        <div id="formStatus"></div>
      </form>
    </div>

    <!-- 統計資訊卡片 -->
    <div class="card" id="statsCard" style="display: none;">
      <h2>📊 目前統計</h2>
      <div id="statsContent">
        <p class="muted">載入中...</p>
      </div>
    </div>

    <!-- 頁尾 -->
    <div class="card" style="text-align: center; background: linear-gradient(135deg, var(--pink-1), var(--pink-2));">
      <p style="margin: 0; color: var(--accent); font-weight: 600;">
        💝 期待與您共度美好時光！
      </p>
    </div>

  </div>

  <script>
    // 已配置您的 Apps Script Web App URL 和 Secret Token
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbz0wuk7Rl8iVd6ox54mFERkPJGSazPeoM32sZx4X2ybOlHd0eG8cwvaMoBsR2o2Tn8/exec?token=rsvp_secret_2025_aB9kL3mN7qR4tW8xY2zA5fH6jK9nP3sV1xC7eG2mQ8vR4tY7zB9kL3nP6sW1xY4zA7fH9jK2mQ5tR8vB1xC4eG7j";

    const form = document.getElementById('rsvpForm');
    const statusEl = document.getElementById('formStatus');
    const submitBtn = document.getElementById('submitBtn');

    // 表單提交處理
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // 檢查是否設定了正確的 URL
      if (WEBAPP_URL.includes('YOUR_DEPLOY_ID') || WEBAPP_URL.includes('YOUR_SECRET_TOKEN')) {
        showStatus('請先設定 Google Apps Script 的部署 URL 和密鑰', 'error');
        return;
      }

      showStatus('正在送出...', 'loading');
      submitBtn.disabled = true;

      const data = {
        name: form.name.value.trim(),
        email: form.email.value.trim(),
        attend: form.attend.value,
        num_people: parseInt(form.num_people.value),
        note: form.note.value.trim()
      };

      try {
        const res = await fetch(WEBAPP_URL, {
          method: 'POST',
          headers: { 
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(data)
        });

        const responseText = await res.text();
        let result;
        
        try {
          result = JSON.parse(responseText);
        } catch (parseError) {
          throw new Error('伺服器回應格式錯誤');
        }

        if (result.status === 'ok') {
          showStatus('✅ 送出成功，謝謝您的回覆！', 'success');
          form.reset();
          
          // 3秒後載入統計資訊
          setTimeout(() => {
            loadStats();
          }, 3000);
        } else {
          showStatus('❌ 送出失敗：' + (result.error || '未知錯誤'), 'error');
        }
      } catch (err) {
        console.error('Form submission error:', err);
        showStatus('❌ 網路錯誤：' + err.message, 'error');
      } finally {
        submitBtn.disabled = false;
      }
    });

    // 顯示狀態訊息
    function showStatus(message, type) {
      statusEl.innerHTML = `<div class="status ${type}">${message}</div>`;
      if (type === 'success') {
        setTimeout(() => {
          statusEl.innerHTML = '';
        }, 5000);
      }
    }

    // 載入統計資訊（可選功能）
    async function loadStats() {
      try {
        const statsUrl = WEBAPP_URL.replace('?token=', '?action=list&token=');
        const res = await fetch(statsUrl);
        const data = await res.json();
        
        if (Array.isArray(data)) {
          displayStats(data);
        }
      } catch (err) {
        console.log('無法載入統計資訊：', err.message);
      }
    }

    // 顯示統計資訊
    function displayStats(responses) {
      const totalResponses = responses.length;
      const attendingCount = responses.filter(r => r.attend === 'yes').length;
      const totalPeople = responses
        .filter(r => r.attend === 'yes')
        .reduce((sum, r) => sum + (parseInt(r.num_people) || 0), 0);

      const statsContent = document.getElementById('statsContent');
      statsContent.innerHTML = `
        <p><strong>總回覆數：</strong>${totalResponses} 人</p>
        <p><strong>確定參加：</strong>${attendingCount} 人</p>
        <p><strong>預計出席總人數：</strong>${totalPeople} 人</p>
      `;
      
      document.getElementById('statsCard').style.display = 'block';
    }

    // publicalbum 初始化：相簿現在會直接顯示
    window.addEventListener('pa-widget-ready', function(e) {
      // publicalbum 成功載入 widget 後會觸發此事件
      console.log('相簿已載入完成');
    });

    // 頁面載入完成後嘗試載入統計資訊（如果需要）
    window.addEventListener('DOMContentLoaded', function() {
      // 可以在這裡添加初始化邏輯
    });
  </script>
</body>
</html>